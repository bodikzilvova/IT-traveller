import{b as pe}from"./base-64-pjGhQ_mO.js";import{s as fe}from"./suggestions-BWbTs_cj.js";import{l as ge}from"./lodash.debounce-BDooTpFg.js";import{i as _}from"./xtend-CeaPpq3n.js";import{e as me}from"./events-CXH2uRM3.js";import{e as ve}from"./eventemitter3-6E4L_h32.js";import{i as ye}from"./is-plain-obj-BUzXRDLz.js";import{r as _e}from"./nanoid-CLXzqmDa.js";import{s as be}from"./subtag-CDP2nEeg.js";var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function rr(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var xe={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function we(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function Re(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var r=t[1],n=t[2].split(";"),i=null,o=n.reduce(function(s,u){var a=we(u);return a?a.key==="rel"?(i||(i=a.value),s):(s[a.key]=a.value,s):s},{});return i?{url:r,rel:i,params:o}:null}function Oe(e){return e?e.split(/,\s*</).reduce(function(t,r){var n=Re(r);if(!n)return t;var i=n.rel.split(/\s+/);return i.forEach(function(o){t[o]||(t[o]={url:n.url,params:n.params})}),t},{}):{}}var Se=Oe,Ce=Se;function M(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=Ce(this.headers.link)}M.prototype.hasNextPage=function(){return!!this.links.next};M.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var Te=M,O={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},I=O;function Ae(e){var t=e.type||I.ERROR_HTTP,r;if(e.body)try{r=JSON.parse(e.body)}catch{r=e.body}else r=null;var n=e.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:t===I.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=r}var Le=Ae;function Me(e){var t=e.indexOf(":"),r=e.substring(0,t).trim().toLowerCase(),n=e.substring(t+1).trim();return{name:r,value:n}}function Pe(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(r){var n=Me(r);t[n.name]=n.value}),t}var ke=Pe,qe=Te,N=Le,S=O,Ge=ke,w={};function Be(e){var t=w[e.id];t&&(t.abort(),delete w[e.id])}function Ie(e,t){return new qe(e,{body:t.response,headers:Ge(t.getAllResponseHeaders()),statusCode:t.status})}function j(e){var t=e.total,r=e.loaded,n=100*r/t;return{total:t,transferred:r,percent:n}}function V(e,t){return new Promise(function(r,n){t.onprogress=function(s){e.emitter.emit(S.EVENT_PROGRESS_DOWNLOAD,j(s))};var i=e.file;i&&(t.upload.onprogress=function(s){e.emitter.emit(S.EVENT_PROGRESS_UPLOAD,j(s))}),t.onerror=function(s){n(s)},t.onabort=function(){var s=new N({request:e,type:S.ERROR_REQUEST_ABORTED});n(s)},t.onload=function(){if(delete w[e.id],t.status<200||t.status>=400){var s=new N({request:e,body:t.response,statusCode:t.status});n(s);return}r(t)};var o=e.body;typeof o=="string"?t.send(o):o?t.send(JSON.stringify(o)):i?t.send(i):t.send(),w[e.id]=t}).then(function(r){return Ie(e,r)})}function F(e,t){var r=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(i){n.setRequestHeader(i,e.headers[i])}),n}function Ne(e){return Promise.resolve().then(function(){var t=F(e,e.client.accessToken);return V(e,t)})}var je={browserAbort:Be,sendRequestXhr:V,browserSend:Ne,createRequestXhr:F},De=pe,C={};function ze(e){if(C[e])return C[e];var t=e.split("."),r=t[0],n=t[1];if(!n)throw new Error("Invalid token");var i=$e(n),o={usage:r,user:i.u};return g(i,"a")&&(o.authorization=i.a),g(i,"exp")&&(o.expires=i.exp*1e3),g(i,"iat")&&(o.created=i.iat*1e3),g(i,"scopes")&&(o.scopes=i.scopes),g(i,"client")&&(o.client=i.client),g(i,"ll")&&(o.lastLogin=i.ll),g(i,"iu")&&(o.impersonator=i.iu),C[e]=o,o}function $e(e){try{return JSON.parse(De.decode(e))}catch{throw new Error("Invalid token")}}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var U=ze;function Ve(e){return e.map(encodeURIComponent).join(",")}function Q(e){return Array.isArray(e)?Ve(e):encodeURIComponent(String(e))}function H(e,t,r){if(r===!1||r===null)return e;var n=/\?/.test(e)?"&":"?",i=encodeURIComponent(t);return r!==void 0&&r!==""&&r!==!0&&(i+="="+Q(r)),""+e+n+i}function Fe(e,t){if(!t)return e;var r=e;return Object.keys(t).forEach(function(n){var i=t[n];i!==void 0&&(Array.isArray(i)&&(i=i.filter(function(o){return o!=null}).join(",")),r=H(r,n,i))}),r}function Ue(e,t){if(!t||e.slice(0,4)==="http")return e;var r=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+r+e}function Qe(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var i=t[n];if(i===void 0)throw new Error("Unspecified route parameter "+n);var o=Q(i);return"/"+o}):e}var He={appendQueryObject:Fe,appendQueryParam:H,prependOrigin:Ue,interpolateRouteParams:Qe},Je=U,P=_,Ke=ve,x=He,D=O,Xe=1;function p(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};t.body&&(r["content-type"]="application/json");var n=P(r,t.headers),i=Object.keys(n).reduce(function(o,s){return o[s.toLowerCase()]=n[s],o},{});this.id=Xe++,this._options=t,this.emitter=new Ke,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=i}p.prototype.url=function(t){var r=x.prependOrigin(this.path,this.origin);r=x.appendQueryObject(r,this.query);var n=this.params,i=t??this.client.accessToken;if(i){r=x.appendQueryParam(r,"access_token",i);var o=Je(i).user;n=P({ownerId:o},n)}return r=x.interpolateRouteParams(r,n),r};p.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(r){return t.response=r,t.emitter.emit(D.EVENT_RESPONSE,r),r},function(r){throw t.error=r,t.emitter.emit(D.EVENT_ERROR,r),r})};p.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};p.prototype.eachPage=function(t){var r=this;function n(s){function u(){delete r._nextPageRequest;var a=s.nextPage();a&&(r._nextPageRequest=a,o(a))}t(null,s,u)}function i(s){t(s,null,function(){})}function o(s){s.send().then(n,i)}o(this)};p.prototype.clone=function(){return this._extend()};p.prototype._extend=function(t){var r=P(this._options,t);return new p(this.client,r)};var We=p,Ze=U,Ye=We,et=O;function J(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");Ze(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||et.API_ORIGIN}J.prototype.createRequest=function(t){return new Ye(this,t)};var K=J,X=je,W=K;function y(e){W.call(this,e)}y.prototype=Object.create(W.prototype);y.prototype.constructor=y;y.prototype.sendRequest=X.browserSend;y.prototype.abortRequest=X.browserAbort;function tt(e){return new y(e)}var Z=tt,rt=Z,nt=rt,it=ye,ot=_,Y="value",T=`
  `,c={};c.assert=function(e,t){return t=t||{},function(r){var n=f(e,r);if(n){var i=k(n,t);throw t.apiName&&(i=t.apiName+": "+i),new Error(i)}}};c.shape=function(t){var r=lt(t);return function(i){var o=f(c.plainObject,i);if(o)return o;for(var s,u,a=[],h=0;h<r.length;h++)s=r[h].key,u=r[h].value,o=f(u,i[s]),o&&a.push([s].concat(o));return a.length<2?a[0]:function(b){a=a.map(function(G){var he=G[0],de=k(G,b).split(`
`).join(T);return"- "+he+": "+de});var E=b.path.join("."),ce=E===Y?"":" of "+E;return"The following properties"+ce+" have invalid values:"+T+a.join(T)}}};c.strictShape=function(t){var r=c.shape(t);return function(i){var o=r(i);if(o)return o;var s=Object.keys(i).reduce(function(u,a){return t[a]===void 0&&u.push(a),u},[]);if(s.length!==0)return function(){return"The following keys are invalid: "+s.join(", ")}}};c.arrayOf=function(t){return ee(t)};c.tuple=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return ee(t)};function ee(e){var t=Array.isArray(e),r=function(n){return t?e[n]:e};return function(i){var o=f(c.plainArray,i);if(o)return o;if(t&&i.length!==e.length)return"an array with "+e.length+" items";for(var s=0;s<i.length;s++)if(o=f(r(s),i[s]),o)return[s].concat(o)}}c.required=function(t){function r(n){return n==null?function(i){return te(i,re(i.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return r.__required=!0,r};c.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var i=t.map(function(o){return f(o,n)}).filter(Boolean);if(i.length===t.length)return i.every(function(o){return o.length===1&&typeof o[0]=="string"})?st(i.map(function(o){return o[0]})):i.reduce(function(o,s){return s.length>o.length?s:o})}};c.equal=function(t){return function(n){if(n!==t)return JSON.stringify(t)}};c.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),r=t.map(function(n){return c.equal(n)});return c.oneOfType.apply(this,r)};c.range=function(t){var r=t[0],n=t[1];return function(o){var s=f(c.number,o);if(s||o<r||o>n)return"number between "+r+" & "+n+" (inclusive)"}};c.any=function(){};c.boolean=function(t){if(typeof t!="boolean")return"boolean"};c.number=function(t){if(typeof t!="number")return"number"};c.plainArray=function(t){if(!Array.isArray(t))return"array"};c.plainObject=function(t){if(!it(t))return"object"};c.string=function(t){if(typeof t!="string")return"string"};c.func=function(t){if(typeof t!="function")return"function"};function f(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var r=e(t);if(r)return Array.isArray(r)?r:[r]}}function k(e,t){var r=e.length,n=e[r-1],i=e.slice(0,r-1);return i.length===0&&(i=[Y]),t=ot(t,{path:i}),typeof n=="function"?n(t):te(t,at(n))}function st(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function at(e){return"must be "+ut(e)+"."}function ut(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function te(e,t){var r=re(e.path),n=e.path.join(".")+" "+t,i=r?"Item at position ":"";return i+n}function re(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function lt(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}c.validate=f;c.processMessage=k;var ct=c,ht=_,v=ct;function dt(e){if(typeof window<"u")return e instanceof B.Blob||e instanceof B.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function pt(e,t){return v.assert(v.strictShape(e),t)}function ft(e){var t="date";if(typeof e=="boolean")return t;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return t}catch{return t}}function gt(e){return v.tuple(v.number,v.number)(e)}var mt=ht(v,{file:dt,date:ft,coordinates:gt,assertShape:pt});function vt(e,t){var r=function(n,i){return t.indexOf(n)!==-1&&i!==void 0};return typeof t=="function"&&(r=t),Object.keys(e).filter(function(n){return r(n,e[n])}).reduce(function(n,i){return n[i]=e[i],n},{})}var yt=vt;function _t(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(n,e[n]),r},{})}var bt=_t,Et=bt;function xt(e){return Et(e,function(t,r){return typeof r=="boolean"?JSON.stringify(r):r})}var wt=xt,Rt=K,Ot=Z;function St(e){return function(t){var r;Rt.prototype.isPrototypeOf(t)?r=t:r=Ot(t);var n=Object.create(e);return n.client=r,n}}var Ct=St,ne=_,l=mt,R=yt,ie=wt,Tt=Ct,q={},oe=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];q.forwardGeocode=function(e){l.assertShape({query:l.required(l.string),mode:l.oneOf("mapbox.places","mapbox.places-permanent"),countries:l.arrayOf(l.string),proximity:l.oneOf(l.coordinates,"ip"),types:l.arrayOf(l.oneOf(oe)),autocomplete:l.boolean,bbox:l.arrayOf(l.number),limit:l.number,language:l.arrayOf(l.string),routing:l.boolean,fuzzyMatch:l.boolean,worldview:l.string})(e),e.mode=e.mode||"mapbox.places";var t=ie(ne({country:e.countries},R(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:R(e,["mode","query"]),query:t})};q.reverseGeocode=function(e){l.assertShape({query:l.required(l.coordinates),mode:l.oneOf("mapbox.places","mapbox.places-permanent"),countries:l.arrayOf(l.string),types:l.arrayOf(l.oneOf(oe)),bbox:l.arrayOf(l.number),limit:l.number,language:l.arrayOf(l.string),reverseMode:l.oneOf("distance","score"),routing:l.boolean,worldview:l.string})(e),e.mode=e.mode||"mapbox.places";var t=ie(ne({country:e.countries},R(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:R(e,["mode","query"]),query:t})};var At=Tt(q),Lt=_e.nanoid;function se(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}se.prototype={select:function(e,t){var r=this.getSelectedIndex(e,t),n=this.getEventPayload("search.select",t);if(n.resultIndex=r,n.resultPlaceName=e.place_name,n.resultId=e.id,!(r===this.lastSentIndex&&n.queryString===this.lastSentInput||r==-1)&&(this.lastSentIndex=r,this.lastSentInput=n.queryString,!!n.queryString))return this.push(n)},start:function(e){var t=this.getEventPayload("search.start",e);if(t.queryString)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var r=this.getEventPayload("search.keystroke",t);if(r.lastAction=e.key,!!r.queryString)return this.push(r)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var r=this.getRequestOptions(e);this.request(r,(function(n){if(n)return this.handleError(n,t);if(t)return t()}).bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t){var r;t.options.proximity?typeof t.options.proximity=="object"?r=[t.options.proximity.longitude,t.options.proximity.latitude]:t.options.proximity==="ip"?r=[999,999]:r=t.options.proximity:r=null;var n=t._map?t._map.getZoom():void 0,i={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:r,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:n,keyboardLocale:this.locale};return e==="search.select"?i.queryString=t.inputString:e!="search.select"&&t._inputEl?i.queryString=t._inputEl.value:i.queryString=t.inputString,i},request:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},r.open(e.method,e.host+"/"+e.path,!0);for(var n in e.headers){var i=e.headers[n];r.setRequestHeader(n,i)}r.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return Lt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var r=t._typeahead.data,n=e.id,i=r.map(function(s){return s.id}),o=i.indexOf(n);return o}},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com"||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var Mt=se,Pt={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},kt={placeholder:Pt};function ae(){}ae.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,r){window.navigator.geolocation.getCurrentPosition(t,r,e)})}};var qt=ae;function Gt(e,t){const r=ue(e),n=["address","street","place","country"];var i;if(typeof t=="function")return t(r);const o=n.indexOf(t);return o===-1?i=n:i=n.slice(o),i.reduce(function(s,u){return r[u]?(s!==""&&(s=s+", "),s+r[u]):s},"")}function ue(e){const t=e.address||"",r=e.text||"",n=e.place_name||"",o={address:n.split(",")[0],houseNumber:t,street:r,placeName:n};return e.context.forEach(function(s){const u=s.id.split(".")[0];o[u]=s.text}),o}const Bt=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var It={transformFeatureToGeolocationText:Gt,getAddressInfo:ue,REVERSE_GEOCODE_COORD_RGX:Bt},Nt=fe,jt=ge,m=_,Dt=me.EventEmitter,z=xe,A=nt,L=At,zt=Mt,$t=kt,Vt=be,Ft=qt,$=It;const d={FORWARD:0,LOCAL:1,REVERSE:2};function Ut(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function le(e){this._eventEmitter=new Dt,this.options=m({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Ft}le.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const i=r.onAdd();n.appendChild(i)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const r=document.querySelectorAll(e);if(r.length===0)throw new Error("Element ",e,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=L(A({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new zt(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",jt(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(h){this.eventManager.keyevent(h,this)}).bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var i=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(i),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(r),t.appendChild(this._inputEl),t.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var o=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(o),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var s=this._typeahead=new Nt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),s.getItemValue=this.options.getItemValue;var u=s.list.draw,a=this._footerNode=Ut();return s.list.draw=function(){u.call(this),a.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),a.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(a)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const r={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(r).send().then((function(n){const i=n.body.features[0];if(i){const o=$.transformFeatureToGeolocationText(i,this.options.addressAccuracy);this._setInputValue(o),i.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:i})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=t,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,r=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var n=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,i=n?n.value:"";if(!i)return this.fresh=!0,e.keyCode!==r&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[r,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&z[e.properties.short_code])t=m({},this.options.flyTo),this._map&&this._map.fitBounds(z[e.properties.short_code].bbox,t);else if(e.bbox){var r=e.bbox;t=m({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)}else{var n={zoom:this.options.zoom};t=m({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var r;return e.localGeocoderOnly?r=d.LOCAL:e.reverseGeocode&&$.REVERSE_GEOCODE_COORD_RGX.test(t)?r=d.REVERSE:r=d.FORWARD,r},_setupConfig:function(e,t){const r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var i=this,o=r.reduce(function(u,a){if(i.options[a]===void 0||i.options[a]===null)return u;["countries","types","language"].indexOf(a)>-1?u[a]=i.options[a].split(n):u[a]=i.options[a];const h=typeof i.options[a].longitude=="number"&&typeof i.options[a].latitude=="number";if(a==="proximity"&&h){const b=i.options[a].longitude,E=i.options[a].latitude;u[a]=[b,E]}return u},{});switch(e){case d.REVERSE:{var s=t.split(n).map(function(u){return parseFloat(u,10)});i.options.flipCoordinates||s.reverse(),o.types&&o.types[0],o=m(o,{query:s,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(u){u in o&&delete o[u]})}break;case d.FORWARD:{const u=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(u)&&(t=t.replace(/,/g," ")),o=m(o,{query:t})}break}return o},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),r=this._setupConfig(t,e);var n;switch(t){case d.LOCAL:n=Promise.resolve();break;case d.FORWARD:n=this.geocoderService.forwardGeocode(r).send();break;case d.REVERSE:n=this.geocoderService.reverseGeocode(r).send();break}var i=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],o=[],s=null;return n.catch((function(u){s=u}).bind(this)).then((function(u){this._hideLoadingIcon();var a={};return u?u.statusCode=="200"&&(a=u.body,a.request=u.request,a.headers=u.headers):a={type:"FeatureCollection",features:[]},a.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),a.features=a.features?i.concat(a.features):i,this.options.externalGeocoder?(o=this.options.externalGeocoder(e,a.features)||Promise.resolve([]),o.then(function(h){return a.features=a.features?h.concat(a.features):h,a},function(){return a})):a}).bind(this)).then((function(u){if(s)throw s;this.options.filter&&u.features.length&&(u.features=u.features.filter(this.options.filter)),u.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",u),this._typeahead.update(u.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",u))}).bind(this)).catch((function(u){this._hideLoadingIcon(),this._hideAttribution(),i.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(i)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:i}),this._eventEmitter.emit("error",{error:u})}).bind(this)),n},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var r=t.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=Vt.language(e),r=$t.placeholder[t];if(r)return r}return"Search"},setInput:function(e,t){return t===void 0&&(t=!1),this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&(t?this._geocode(e):this._onChange()),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.options.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=L(A({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=L(A({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},r=m({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(r),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var Qt=le;const nr=Ee(Qt);export{nr as M,rr as a,B as c,Ee as g};
